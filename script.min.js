var audioCtx,source,analyser,scriptProcessor,audio=document.getElementById("player2"),loadingOverlay=document.getElementById("loadingOverlay"),audioContainer=document.getElementById("audioContainer"),peakMeter=document.getElementById("peakMeter"),peakLevel=document.getElementById("peakLevel"),peakLevelValue=document.getElementById("peakLevelValue"),togglePeakBar=document.getElementById("togglePeakBar");function initAudioContext(){audioCtx=new(window.AudioContext||window.AudioContext),source=audioCtx.createMediaElementSource(audio),(analyser=audioCtx.createAnalyser()).fftSize=512;var e=analyser.frequencyBinCount;new Uint8Array(e);source.connect(analyser),analyser.connect(audioCtx.destination),scriptProcessor=audioCtx.createScriptProcessor(2048,1,1),analyser.connect(scriptProcessor),scriptProcessor.connect(audioCtx.destination)}function startAudioContext(){audioCtx&&"suspended"===audioCtx.state&&audioCtx.resume().then(function(){console.log("Audio context resumed.")})}togglePeakBar.addEventListener("change",function(){togglePeakBar.checked?peakMeter.style.display="block":peakMeter.style.display="none"}),audio.addEventListener("canplaythrough",function(){loadingOverlay.classList.add("fade-out"),setTimeout(function(){loadingOverlay.classList.add("hidden")},500)}),audio.onerror=function(){loadingOverlay.classList.add("fade-out"),setTimeout(function(){loadingOverlay.classList.add("hidden")},500)},audio.addEventListener("play",function(){startAudioContext(),scriptProcessor.onaudioprocess=function(e){togglePeakBar.checked&&(e=e.inputBuffer.getChannelData(0),0===(e=1e3*Math.max.apply(null,e))?peakLevel.style.display="none":(peakLevel.style.display="block",peakLevel.style.width=(e=100<e?100:e)+"vw"))}}),document.addEventListener("click",function(){audioCtx||initAudioContext()});var loadingTimer=setTimeout(function(){showSkipButton()},2e3);function showSkipButton(){var e=document.getElementById("skipButton");e.classList.remove("hidden"),e.addEventListener("click",function(){loadingOverlay.classList.add("fade-out"),setTimeout(function(){loadingOverlay.classList.add("hidden")},500)})}togglePeakBar.addEventListener("change",function(){togglePeakBar.checked?(peakMeter.style.display="block",audio.paused&&(audio.play(),audio.pause())):(peakMeter.style.display="none",audio.paused||(audio.pause(),audio.play()))});